<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>《Unity Shader 入门精要》读书笔记（入门篇共4章） - 资料库</title>
<link rel="shortcut icon" href="https://singledigit9.github.io/favicon.ico">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.2.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css">
<link rel="stylesheet" href="https://singledigit9.github.io/media/css/tailwind.css">
<link rel="stylesheet" href="https://singledigit9.github.io/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="《Unity Shader 入门精要》读书笔记（入门篇共4章） - 资料库 - Atom Feed" href="https://singledigit9.github.io/atom.xml">

    

  <meta name="description" content="写在前面
内容比预想的要多，进度有些慢，一点点来吧。


第五章 开始Unity Shader学习之旅
这里记录一些基本概念类的知识，涉及到代码的，写在另一篇文章里，方便查阅。
Shader的一些基基础知识

顶点着色器是逐顶点调用的，片元..." />
  <meta property="og:title" content="《Unity Shader 入门精要》读书笔记（入门篇共4章） - 资料库">
  <meta property="og:description" content="写在前面
内容比预想的要多，进度有些慢，一点点来吧。


第五章 开始Unity Shader学习之旅
这里记录一些基本概念类的知识，涉及到代码的，写在另一篇文章里，方便查阅。
Shader的一些基基础知识

顶点着色器是逐顶点调用的，片元..." />
  <meta property="og:type" content="articles">
  <meta property="og:url" content="https://singledigit9.github.io/post/lesslessunity-shader-ru-men-jing-yao-greatergreater-du-shu-bi-ji-ru-men-pian/" />
  <meta property="og:image" content="https://singledigit9.github.io/images/avatar.png">
  <meta property="og:image:height" content="630">
  <meta property="og:image:width" content="1200">
  <meta name="twitter:title" content="《Unity Shader 入门精要》读书笔记（入门篇共4章） - 资料库">
  <meta name="twitter:description" content="写在前面
内容比预想的要多，进度有些慢，一点点来吧。


第五章 开始Unity Shader学习之旅
这里记录一些基本概念类的知识，涉及到代码的，写在另一篇文章里，方便查阅。
Shader的一些基基础知识

顶点着色器是逐顶点调用的，片元...">
  <meta name="twitter:card" content="summary_large_image">
  <link rel="canonical" href="https://singledigit9.github.io/post/lesslessunity-shader-ru-men-jing-yao-greatergreater-du-shu-bi-ji-ru-men-pian/">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css">
 
  
    <link rel="stylesheet" href="https://singledigit9.github.io/media/css/prism-atom-dark.css">
  

  
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
  
</head>

<body>
  <div class="antialiased flex flex-col min-h-screen" id="app">
    <a href="https://singledigit9.github.io" class="fixed top-0 left-0 mt-4 bg-black text-white dark:text-gray-700 dark:bg-yellow-50 dark:hover:bg-black dark:hover:text-white inline-flex p-2 pl-8 hover:text-gray-700 hover:bg-yellow-50 font-bold z-10 transition-fast animated fadeInLeft">
      资料库
    </a>
    <div class="max-w-4xl w-full mx-auto">
      <div class="shadow-box bg-white dark:bg-gray-600 rounded-lg pt-32 md:pt-64 px-4 md:px-8 pb-8 animated fadeIn mb-8">
        <h1 class="text-5xl font-semibold leading-normal pb-8 mb-8 border-b-8 border-gray-700">
          《Unity Shader 入门精要》读书笔记（入门篇共4章）
        </h1>
        
        <div class="mb-8 flex flex-wrap">
          <div class="text-gray-400 text-sm mr-4">2020-05-01 · 14 min read</div>
          
            <a href="https://singledigit9.github.io/tag/UjKOtFN6l/" class="text-gray-700 text-sm border-b-2 border-dotted border-gray-200 hover:border-gray-600 transition-all duration-100 inline-flex mr-2">
              <i class="ri-hashtag"></i>
              读书笔记
            </a>
          
            <a href="https://singledigit9.github.io/tag/iHLk7fHQm9/" class="text-gray-700 text-sm border-b-2 border-dotted border-gray-200 hover:border-gray-600 transition-all duration-100 inline-flex mr-2">
              <i class="ri-hashtag"></i>
              Unity3D
            </a>
          
            <a href="https://singledigit9.github.io/tag/dk8wleA28S/" class="text-gray-700 text-sm border-b-2 border-dotted border-gray-200 hover:border-gray-600 transition-all duration-100 inline-flex mr-2">
              <i class="ri-hashtag"></i>
              Shader
            </a>
          
        </div>
        <div class="markdown mb-8" v-pre>
          <h3 id="写在前面">写在前面</h3>
<p>内容比预想的要多，进度有些慢，一点点来吧。</p>
<!-- more -->
<hr>
<h3 id="第五章-开始unity-shader学习之旅">第五章 开始Unity Shader学习之旅</h3>
<p>这里记录一些基本概念类的知识，涉及到代码的，写在另一篇文章里，方便查阅。</p>
<h4 id="shader的一些基基础知识">Shader的一些基基础知识</h4>
<ol>
<li>顶点着色器是逐顶点调用的，片元着色器是逐片元调用的。片元着色器实际上是把顶点着色器的输入进行插值后得到的结果。</li>
<li>属性定义后，需要在CG代码块中定义一个类型匹配，名字相同的变量。</li>
<li><code>uniform</code>：表示变量初始化来自于外部程序，可以省略。</li>
<li><code>#include &quot;UnityCG.cginc&quot;</code>：类似于C++的include</li>
<li>语义：赋给输入和输出的字符串，字符串表达了参数的含义。语义可以让Shader知道从哪里读取数据，返回的是什么数据。
<ol>
<li>有些<code>SV</code>开头的语义，其中<code>SV</code>表示的是<strong>系统数值</strong></li>
</ol>
</li>
</ol>
<h4 id="shader的debug方法">Shader的Debug方法</h4>
<ol>
<li>将要调试的变量值转换到（0，1），并用单颜色或者多颜色进行输出显示。</li>
<li>需要注意的是，<strong>颜色分量大于1的会等于1，小于0的会等于0</strong></li>
</ol>
<h4 id="注意渲染平台的差异">注意渲染平台的差异</h4>
<ol>
<li>渲染纹理坐标差异
<ol>
<li>OpenGL，原点在左下角</li>
<li>DX，原点在左上角</li>
<li>通常情况下，Unity会根据平台自动进行翻转。但是有一种特殊情况：Unity Quality设置开启了抗锯齿，处理多张渲染图像时，DX垂直方向的朝向可能不同，需要手动翻转。<pre><code class="language-shader">#if UNITY_UV_STARTS_AT_TOP // 判断当前平台是不是DX平台 
if (_MainTex.TexelSize.y &lt; 0)
{
    uv.y = 1 - uv.y;
}
#endif
</code></pre>
</li>
</ol>
</li>
<li>语法差异
<ol>
<li>简单来说，DX的语法要求更加严格，为了使自己的Shader代码跨平台性更好，写代码时要注意规范。
<ol>
<li>要求变量初始化参数数量必须严格匹配，<code>float3(1)</code>这种初始化方式是不允许的。</li>
<li>要求带有 out 关键字的参数必须被初始化。<pre><code class="language-shader">UNITY_INITIALIZE_OUTPUT([类型], [变量名])//使用Unity内置的宏对输出结构体进行初始化
</code></pre>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<h4 id="shader代码注意事项">Shader代码注意事项</h4>
<ol>
<li>float，half，fixed的选择：尽可能选用低精度的
<ol>
<li>PC的GPU会把所有的浮点数按照最高京都市进行计算==&gt;PC上基本看不出差别</li>
<li>移动平台GPU上，会有不同的精度和计算速度的差别。所以<strong>一定要在移动平台验证Shader</strong>。</li>
<li>大多数现代GPU上，half和fixed是等价的。</li>
</ol>
</li>
<li>规范语法。使用和变量类型匹配的参数数目来对变量进行初始化。</li>
<li>避免不必要的计算。大量计算会导致Shader报错。</li>
<li>慎用分支语句和循环语句
<ol>
<li>GPU实现分支语句和CPU不同，最坏的情况，执行一个分之语句的时间相当于执行了所有分之的时间。<strong>分支语句会降低GPU的并行操作</strong>。</li>
<li>复杂计算考虑把计算往上移：片元着色器--&gt;顶点着色器--&gt;CPU。（<strong>顶点比片元少</strong>）</li>
<li>不能避免的分支语句时
<ol>
<li>条件变量最好是常数</li>
<li>每个分支中进行的操作尽可能少</li>
<li>分支嵌套层数尽可能少</li>
</ol>
</li>
</ol>
</li>
<li>不要除以0，可能在不同平台有不同表现的错误。
<ol>
<li>一个解决方法就是将可能为0的除数的强制截取到非0的范围</li>
</ol>
</li>
</ol>
<hr>
<h3 id="第六章-unity中的基础光照">第六章 Unity中的基础光照</h3>
<h4 id="光照模型的物理依据">光照模型的物理依据</h4>
<ul>
<li>吸收和散射
<ol>
<li>散射改变光的方向，但不改变光的颜色和密度。
<ol>
<li>光经过物体表面进行散射时，一部分散射到内部——折射或者投射；一部分散射到外部——反射。</li>
<li>对于不透明的物体，折射进物体内部的光线会继续与物体内部的颗粒进行相交，其中一部分光线会重新发射出物体表面，而另外一部分被物体吸收</li>
</ol>
</li>
<li>吸收只改变光的颜色和密度，不改变光的方向。</li>
<li>高光反射Specular：物体表面如何反射光线</li>
<li>漫反射Diffuse：有多少光线会被折射，吸收和散射出表面。</li>
</ol>
</li>
</ul>
<h4 id="光照模型">光照模型</h4>
<p>光照模型实际上是一个平衡了计算速度和表现效果经验模型。</p>
<ul>
<li>标准光照模型：将光线分成四个部分
<ol>
<li>自发光emissive
<ol>
<li>物体自己的发光</li>
</ol>
</li>
<li>高光反射specular
<ol>
<li>是一种经验模型，并不完全符合真是世界中的高光反射。</li>
<li>Phong模型：<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>c</mi><mrow><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mi>u</mi><mi>l</mi><mi>a</mi><mi>r</mi></mrow></msub><mo>=</mo><mo>(</mo><msub><mi>c</mi><mrow><mi>l</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow></msub><mo separator="true">⋅</mo><msub><mi>m</mi><mrow><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mi>u</mi><mi>l</mi><mi>a</mi><mi>r</mi></mrow></msub><mo>)</mo><mo separator="true">⋅</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo>(</mo><mn>0</mn><mo separator="true">,</mo><mi>v</mi><mo separator="true">⋅</mo><mi>r</mi><msup><mo>)</mo><msub><mi>m</mi><mrow><mi>g</mi><mi>l</mi><mi>o</mi><mi>s</mi><mi>s</mi></mrow></msub></msup></mrow><annotation encoding="application/x-tex">c_{specular}=(c_{light}·m_{specular})·max(0, v·r)^{m_{gloss}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mord mathdefault mtight">h</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29011428571428566em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>
<ol>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>m</mi><mrow><mi>g</mi><mi>l</mi><mi>o</mi><mi>s</mi><mi>s</mi></mrow></msub></mrow><annotation encoding="application/x-tex">m_{gloss}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>：光泽度，控制亮点宽度</li>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>m</mi><mrow><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mi>u</mi><mi>l</mi><mi>a</mi><mi>r</mi></mrow></msub></mrow><annotation encoding="application/x-tex">m_{specular}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>：高光反射颜色</li>
<li>r：反射方向</li>
<li>v：观察方向</li>
</ol>
</li>
<li>Blinn模型：<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>c</mi><mrow><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mi>u</mi><mi>l</mi><mi>a</mi><mi>r</mi></mrow></msub><mo>=</mo><mo>(</mo><msub><mi>c</mi><mrow><mi>l</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow></msub><mo separator="true">⋅</mo><msub><mi>m</mi><mrow><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mi>u</mi><mi>l</mi><mi>a</mi><mi>r</mi></mrow></msub><mo>)</mo><mo separator="true">⋅</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo>(</mo><mn>0</mn><mo separator="true">,</mo><mi>n</mi><mo separator="true">⋅</mo><mi>h</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">c_{specular}=(c_{light} · m_{specular}) · max(0, n · h)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mord mathdefault mtight">h</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">n</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">h</span><span class="mclose">)</span></span></span></span>
<ol>
<li>n：法线方向</li>
<li>h：法线和光源方向的夹角方向的单位向量</li>
</ol>
</li>
<li>摄像机和光源里物体足够远时，使用Blinn模型比较块，这是因为观察方向和光源方向可以认为是定值。当观察方向和光源方向不是定值时，Phong模型可能更快。</li>
</ol>
</li>
<li>漫反射diffuse
<ol>
<li>兰伯特定律：反射光线的强度和表面法线与光源方向之间夹角的余弦成正比。</li>
<li>兰伯特光照模型：<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>c</mi><mrow><mi>d</mi><mi>i</mi><mi>f</mi><mi>f</mi><mi>u</mi><mi>s</mi><mi>e</mi></mrow></msub><mo>=</mo><mo>(</mo><msub><mi>c</mi><mrow><mi>l</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow></msub><mo separator="true">⋅</mo><msub><mi>m</mi><mrow><mi>d</mi><mi>i</mi><mi>f</mi><mi>f</mi><mi>u</mi><mi>s</mi><mi>e</mi></mrow></msub><mo>)</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo>(</mo><mn>0</mn><mo separator="true">,</mo><mi>n</mi><mo separator="true">⋅</mo><mi>I</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">c_{diffuse}=(c_{light}·m_{diffuse})max(0, n·I)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mord mathdefault mtight">h</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">n</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mclose">)</span></span></span></span>
<ol>
<li>I：光源方向</li>
</ol>
</li>
<li>半兰伯特光照模型：<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>c</mi><mrow><mi>d</mi><mi>i</mi><mi>f</mi><mi>f</mi><mi>u</mi><mi>s</mi><mi>e</mi></mrow></msub><mo>=</mo><mo>(</mo><msub><mi>c</mi><mrow><mi>l</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow></msub><mo separator="true">⋅</mo><msub><mi>m</mi><mrow><mi>d</mi><mi>i</mi><mi>f</mi><mi>f</mi><mi>u</mi><mi>s</mi><mi>e</mi></mrow></msub><mo>)</mo><mo>(</mo><mi>a</mi><mo>(</mo><mi>n</mi><mo separator="true">⋅</mo><mi>I</mi><mo>)</mo><mo>+</mo><mi>b</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">c_{diffuse}=(c_{light}·m_{diffuse})(a(n·I)+b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mord mathdefault mtight">h</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathdefault">a</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">b</span><span class="mclose">)</span></span></span></span>
<ol>
<li>其中a，b常常取0.5</li>
<li>这个模型是为了解决兰伯特模型上背光区显示为黑，失去细节展现的问题。</li>
<li>这个模型没有物理依据，仅仅是为了视觉加强。</li>
</ol>
</li>
</ol>
</li>
<li>环境光ambient
<ol>
<li>一个物体收到其他物体的反射投射光影响的光照情况</li>
</ol>
</li>
</ol>
</li>
</ul>
<h4 id="关于光照的计算位置">关于光照的计算位置</h4>
<p>光照计算可以在片元着色器中，也可以在顶点着色器中，分别被称为逐片元光照和逐顶点光照。由于顶点数目往往小于像素数目，所以逐顶点光照的消耗通常要小于逐片元光照。因为逐顶点光照依赖插值来得到最终的像素光照，所以当光照中有非线性计算时（比如高光反射），逐顶点光照的表现就会有问题。一般高光会相对较暗，有些情况下可能会有棱角。</p>
<h4 id="unity中关于环境光的特殊设置">Unity中关于环境光的特殊设置</h4>
<p>Unity中环境光可以在Light界面中进行设置。（Windows-&gt;Rendering-&gt;Lighing）</p>
<hr>
<h3 id="第七章-基础纹理">第七章 基础纹理</h3>
<h4 id="shader中纹理属性的特殊定义">Shader中纹理属性的特殊定义。</h4>
<ol>
<li><strong>除了在CG中定义纹理<code>sampler2D _MainTex</code>以外，还需要定义<code>float4 _MainTex_ST</code>。</strong></li>
<li><code>float4 _MainTex_ST</code>的名字是有规范的。规范格式为<code>float4 [纹理字段名字]_ST</code>。</li>
<li>其中ST中的S代表缩放，T代表平移</li>
<li>xy存储的是缩放值，zw存储的是偏移值。</li>
</ol>
<h4 id="unity中关于纹理的一些基础知识和设置">Unity中关于纹理的一些基础知识和设置</h4>
<ol>
<li>Unity中的纹理坐标（UV坐标）是以左下角为原点的。</li>
<li>Unity中的纹理：纹理导入Unity后，检视面板上有一些关于纹理的细节设置。<br>
<a href="https://docs.unity3d.com/ScriptReference/TextureWrapMode.html"><em>TextureWrapMode</em></a>
<ol>
<li>WrapMode：设置当纹理坐标超过[0, 1]后，如何平铺该纹理
<ol>
<li>Repeat：如果纹理大于1，将直接使用小数部分进行显示（uv在[0, 1]之间循环）==&gt;不断重复</li>
<li>Clamp：如果纹理UV大于1，会被截取到1；如果小于0，则会被截取到0。</li>
<li>Mirror：镜像。UV在[0, 1][1, 0]之间重复</li>
<li>MirrorOnce：镜像一次。这个有跨平台问题。UV在[-1, 1]之间时使用Mirror的规则，超出范围则强制取最大最小范围值。</li>
</ol>
</li>
<li>Filter Mode：决定纹理因为变换而产生拉伸时，使用哪种滤波形式。（从上到下，效果增加，消耗增加）<br>
纹理滤波会影响放大缩小纹理时所使用的图片质量。
<ol>
<li>Point：采样像素只有一个。放大的图片会有比较明显的像素颗粒感。</li>
<li>Bilinear：采样像素为临近四个，然后线性插值。这会导致放大的图片会变得模糊。</li>
<li>Trilinear：除了Bilinear操作外，还会在渐远多级纹理之间进行混合。如果纹理没有使用多级渐远纹理技术，则最终的效果和Bilinear一样。</li>
</ol>
</li>
<li>多级渐变纹理mipmapping
<ol>
<li>预先生成降级采样的缩小的图片，在实时显示时，可以直接选取对应的图片进行显示，而不用额外计算。</li>
<li>通常会多占33%的空间。</li>
</ol>
</li>
<li>导入的图片可以不是正方形的，但长宽应该时2的n次幂。如果使用非2的n次幂的图片，往往会占据更大的空间，GPU读取纹理的速度也会下降。</li>
<li>纹理的压缩格式要根据实际情况进行选择。比如一张图片要求的精确显示，则可以考虑将它设置成高压缩的格式，以减少内存的占用。在图片不需要alpha通道时，选取去除alpha的压缩格式，来减少内存占用。</li>
</ol>
</li>
</ol>
<h4 id="凹凸映射">凹凸映射</h4>
<ol>
<li>高度映射
<ol>
<li>使用高度纹理模拟表面位移，计算得到修改后的法线值。</li>
<li>高度纹理存储的时强度值。</li>
<li>优点：直观</li>
<li>缺点：计算复杂，不能直接得到法线信息，需要根据计算像素的灰度来计算得出。从而消耗更多性能。</li>
</ol>
</li>
<li>法线纹理：
<ol>
<li>直接使用法线纹理存储表面法线。</li>
<li>法线方向和像素之间的转换公式：
<ol>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi><mi>i</mi><mi>x</mi><mi>e</mi><mi>l</mi><mo>=</mo><mo>(</mo><mi>n</mi><mi>o</mi><mi>r</mi><mi>m</mi><mi>a</mi><mi>l</mi><mo>+</mo><mn>1</mn><mo>)</mo><mi mathvariant="normal">/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">pixel = (normal + 1)/2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span><span class="mord mathdefault">i</span><span class="mord mathdefault">x</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord">/</span><span class="mord">2</span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mi>o</mi><mi>r</mi><mi>m</mi><mi>a</mi><mi>l</mi><mo>=</mo><mi>p</mi><mi>i</mi><mi>x</mi><mi>e</mi><mi>l</mi><mo>∗</mo><mn>2</mn><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">normal = pixel * 2 - 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">n</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span><span class="mord mathdefault">i</span><span class="mord mathdefault">x</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></li>
</ol>
</li>
<li>法线纹理的类型（优缺点要对比着看）：一般都使用切线空间下的法线纹理
<ol>
<li>基于模型空间的法线纹理：以模型空间为基准
<ol>
<li>优点：
<ol>
<li>简单直观。计算更少，生成方便。</li>
<li>缝合处和尖锐的部分可见缝隙少，能够提供光滑的边界。（因为法线纹理和贴图纹理所在的空间一致，可以通过插值来实现平滑的变换）</li>
</ol>
</li>
<li>缺点：
<ol>
<li>记录的时绝对法线，不能复用。</li>
<li>无法使用法线UV动画</li>
<li>需要存储xyz所有值，无法压缩</li>
</ol>
</li>
</ol>
</li>
<li>基于切线空间的法线纹理：以各自顶点为原点，以切线方向为x轴，副切线（或者副法线）为y轴，法线方向为z轴的空间。
<ol>
<li>优点：
<ol>
<li>自由度高。记录的是相对法线信息，可以将它用在不同的网格上。</li>
<li>可以使用法线来做UV动画来实现凹凸移动效果。</li>
<li>可复用。</li>
<li>可压缩。因为切线空间中法线的z方向始终是正方向，所以我们可以通过xy只来计算z方向的值。</li>
</ol>
</li>
<li>缺点：
<ol>
<li>缝合处和边缘尖锐出坑有缝隙</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li>世界空间下副切线的计算步骤<pre><code class="language-shader">fixed3 worldNormal = UnityObjectToWorldNormal(v.normal);
fixed3 worldTangent = UnityObjectToWorldDir(v.tangent.xyz);
fixed tangentSign = v.tangent.w * unity_WorldTransformParams.w;
fixed3 worldBinormal = cross(worldNormal, worldTangent) * tangentSign;
</code></pre>
<ol>
<li>v.tangent.w：由模型编辑软件自动生成。</li>
<li>unity_WorldTransformParams.w：该参数在UnityShaderVariables.cginc中。
<ol>
<li>自带的注释：<code>w is usually 1.0, or -1.0 for odd-negative scale transforms</code></li>
<li>模型Scale值xyz，有奇数个为负，则w为负。（目前个人理解是因为模型因为Scale镜像翻转了）</li>
</ol>
</li>
<li>参考资料：<a href="https://zhuanlan.zhihu.com/p/103546030"><em>关于顶点的法线、切线、副切线</em></a></li>
</ol>
</li>
<li>可以将光线方向和观察方向转到切线空间中进行计算，也可以将法线贴图中的到的法线转到世界空间中进行计算。</li>
<li>Unity中法线纹理的设置。设置成Normal Map
<ol>
<li>可以针对不同平台设置不同的压缩格式。</li>
<li>有一个CreateFromGrayscale选项，用于从高度图生成法线纹理图。
<ol>
<li>Bumpiness：控制凹凸程度</li>
<li>Filtering：使用哪种算法生成法线纹理。smooth比较平滑，sharp使用了边缘检测来生成法线。</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<h4 id="渐变纹理">渐变纹理</h4>
<ol>
<li>原来的漫反射公式中，漫反射颜色参数是一个定值</li>
<li>在使用渐变纹理时，漫反射颜色是动态在渐变贴图中采样的。</li>
<li>依据参数就是漫反射光照模型公式中的常数量（法线和光照的点积）</li>
</ol>
<h4 id="遮照纹理">遮照纹理</h4>
<ol>
<li>使用流程
<ol>
<li>采样遮照纹理</li>
<li>使用某个或者某几个颜色值，与某种表面属性相乘。</li>
<li>一般来讲，当上面的结果为0时，这个表面属性就不起作用了。</li>
</ol>
</li>
<li>优点
<ol>
<li>可以让美术人员更加精准的控制模型表面的各种属性。</li>
</ol>
</li>
<li>在实际开发的过程中，要充分利用贴图的rgba属性。比如r存储高光反射遮照，g存储边缘光照强度，b存储自发光，a存储高光反射指数部分等等。</li>
</ol>
<hr>
<h3 id="第八章-透明效果">第八章 透明效果</h3>
<h4 id="unity中实现透明的两种方式">Unity中实现透明的两种方式</h4>
<p><strong>透明度测试</strong>和<strong>透明度混合</strong></p>
<h4 id="透明度测试">透明度测试</h4>
<ul>
<li>只要某个片元没有通过测试，则该片元直接被舍弃==&gt;产生的效果是要么完全透明，要么完全不透明</li>
</ul>
<h4 id="透明度混合">透明度混合</h4>
<ol>
<li>透明度混合：能够真正得到半透明效果。但需要<strong>关闭深度写入</strong>。因此要格外注意渲染顺序。
<ol>
<li>如果不关闭深度写入，那么透明物体后面的物体会因为深度测试而被剔除掉。</li>
</ol>
</li>
<li>书上关于不同渲染顺序与显示结果的影响的说明（A半透明，B不透明）<br>
<img src="https://singledigit9.github.io/post-images/1588512225204.jpeg" alt="" loading="lazy"></li>
<li>一般引擎解决渲染排序的方法
<ol>
<li>先渲染所有不透明物体，并开启深度测试和深度写入</li>
<li>把半透明物体按照离摄像机远近进行排序，然后按照从后向前的顺序进行渲染。开启深度测试，关闭深度写入。</li>
</ol>
</li>
<li>Unity解决渲染排序的方法 ：在Tags中使用<strong>Queue</strong>。需要注意的是，<strong>透明度混合需要关闭深度写入</strong></li>
<li>透明度混合需要使用Blend指令。Blend命令设置了混合的计算方法。具体的指令写在另一篇文章里，方便查阅。</li>
</ol>
<h4 id="自带交叉的模型的透明度渲染">自带交叉的模型的透明度渲染</h4>
<ol>
<li>第一个Pass进行深度写入，但不输出颜色。</li>
<li>第二个Pass关闭深度写入，进行正常的透明度颜色混合。</li>
</ol>
<h4 id="透明物体的双面渲染关键字-cull">透明物体的双面渲染（关键字 Cull）</h4>
<ol>
<li>第一个Pass先渲染背面</li>
<li>第二个Pass再渲染正面</li>
</ol>

        </div>
        <!-- Share to Twitter, Weibo, Telegram -->
        <div class="flex items-center">
          <div class="mr-4 flex items-center">
            <i class="ri-share-forward-line text-gray-500"></i>
          </div>
          <div class="px-4 cursor-pointer text-blue-500 hover:bg-blue-100 dark:hover:bg-gray-600 inline-flex" @click="shareToTwitter">
            <i class="ri-twitter-line"></i>
          </div>
          <div class="px-4 cursor-pointer text-red-500 hover:bg-red-100 dark:hover:bg-gray-600 inline-flex" @click="shareToWeibo">
            <i class="ri-weibo-line"></i>
          </div>
          <div class="px-4 cursor-pointer text-indigo-500 hover:bg-indigo-100 dark:hover:bg-gray-600 inline-flex" @click="shareToTelegram">
            <i class="ri-telegram-line"></i>
          </div>
        </div>
      </div>

      

      
        <div id="vlaine-comment"></div>
      

      <footer class="py-12 text-center px-4 md:px-0" v-pre>
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
</footer>
    </div>

    <!-- TOC Container -->
    <div class="fixed right-0 bottom-0 mb-16 mr-4 shadow w-8 h-8 rounded-full flex justify-center items-center z-10 cursor-pointer bg-white dark:bg-gray-500 dark:text-gray-200 hover:shadow-lg transition-all animated fadeInRight" @click="showToc = true">
      <i class="ri-file-list-line"></i>
    </div>

    <div class="fixed right-0 top-0 bottom-0 overflow-y-auto w-64 bg-white dark:bg-gray-800 p-4 border-l border-gray-100 dark:border-gray-600 z-10 transition-fast" :class="{ '-mr-64': !showToc }">
      <div class="flex mb-4 justify-end">
        <div class="w-8 h-8 inline-flex justify-center items-center rounded-full cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600 transition-fast" @click="showToc = false">
          <i class="ri-close-line text-lg"></i>
        </div>
      </div>
      <div class="post-toc-container">
        <ul class="markdownIt-TOC">
<li>
<ul>
<li>
<ul>
<li><a href="#%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2">写在前面</a></li>
<li><a href="#%E7%AC%AC%E4%BA%94%E7%AB%A0-%E5%BC%80%E5%A7%8Bunity-shader%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%97%85">第五章 开始Unity Shader学习之旅</a>
<ul>
<li><a href="#shader%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9F%BA%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86">Shader的一些基基础知识</a></li>
<li><a href="#shader%E7%9A%84debug%E6%96%B9%E6%B3%95">Shader的Debug方法</a></li>
<li><a href="#%E6%B3%A8%E6%84%8F%E6%B8%B2%E6%9F%93%E5%B9%B3%E5%8F%B0%E7%9A%84%E5%B7%AE%E5%BC%82">注意渲染平台的差异</a></li>
<li><a href="#shader%E4%BB%A3%E7%A0%81%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9">Shader代码注意事项</a></li>
</ul>
</li>
<li><a href="#%E7%AC%AC%E5%85%AD%E7%AB%A0-unity%E4%B8%AD%E7%9A%84%E5%9F%BA%E7%A1%80%E5%85%89%E7%85%A7">第六章 Unity中的基础光照</a>
<ul>
<li><a href="#%E5%85%89%E7%85%A7%E6%A8%A1%E5%9E%8B%E7%9A%84%E7%89%A9%E7%90%86%E4%BE%9D%E6%8D%AE">光照模型的物理依据</a></li>
<li><a href="#%E5%85%89%E7%85%A7%E6%A8%A1%E5%9E%8B">光照模型</a></li>
<li><a href="#%E5%85%B3%E4%BA%8E%E5%85%89%E7%85%A7%E7%9A%84%E8%AE%A1%E7%AE%97%E4%BD%8D%E7%BD%AE">关于光照的计算位置</a></li>
<li><a href="#unity%E4%B8%AD%E5%85%B3%E4%BA%8E%E7%8E%AF%E5%A2%83%E5%85%89%E7%9A%84%E7%89%B9%E6%AE%8A%E8%AE%BE%E7%BD%AE">Unity中关于环境光的特殊设置</a></li>
</ul>
</li>
<li><a href="#%E7%AC%AC%E4%B8%83%E7%AB%A0-%E5%9F%BA%E7%A1%80%E7%BA%B9%E7%90%86">第七章 基础纹理</a>
<ul>
<li><a href="#shader%E4%B8%AD%E7%BA%B9%E7%90%86%E5%B1%9E%E6%80%A7%E7%9A%84%E7%89%B9%E6%AE%8A%E5%AE%9A%E4%B9%89">Shader中纹理属性的特殊定义。</a></li>
<li><a href="#unity%E4%B8%AD%E5%85%B3%E4%BA%8E%E7%BA%B9%E7%90%86%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E5%92%8C%E8%AE%BE%E7%BD%AE">Unity中关于纹理的一些基础知识和设置</a></li>
<li><a href="#%E5%87%B9%E5%87%B8%E6%98%A0%E5%B0%84">凹凸映射</a></li>
<li><a href="#%E6%B8%90%E5%8F%98%E7%BA%B9%E7%90%86">渐变纹理</a></li>
<li><a href="#%E9%81%AE%E7%85%A7%E7%BA%B9%E7%90%86">遮照纹理</a></li>
</ul>
</li>
<li><a href="#%E7%AC%AC%E5%85%AB%E7%AB%A0-%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C">第八章 透明效果</a>
<ul>
<li><a href="#unity%E4%B8%AD%E5%AE%9E%E7%8E%B0%E9%80%8F%E6%98%8E%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F">Unity中实现透明的两种方式</a></li>
<li><a href="#%E9%80%8F%E6%98%8E%E5%BA%A6%E6%B5%8B%E8%AF%95">透明度测试</a></li>
<li><a href="#%E9%80%8F%E6%98%8E%E5%BA%A6%E6%B7%B7%E5%90%88">透明度混合</a></li>
<li><a href="#%E8%87%AA%E5%B8%A6%E4%BA%A4%E5%8F%89%E7%9A%84%E6%A8%A1%E5%9E%8B%E7%9A%84%E9%80%8F%E6%98%8E%E5%BA%A6%E6%B8%B2%E6%9F%93">自带交叉的模型的透明度渲染</a></li>
<li><a href="#%E9%80%8F%E6%98%8E%E7%89%A9%E4%BD%93%E7%9A%84%E5%8F%8C%E9%9D%A2%E6%B8%B2%E6%9F%93%E5%85%B3%E9%94%AE%E5%AD%97-cull">透明物体的双面渲染（关键字 Cull）</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

      </div>
    </div>

    <!-- Back to top -->
    <div class="fixed right-0 bottom-0 mb-4 mr-4 shadow w-8 h-8 rounded-full flex justify-center items-center z-10 cursor-pointer bg-white hover:shadow-lg transition-all dark:bg-gray-500 dark:text-gray-200" @click="backToUp" v-show="scrolled">
      <i class="ri-arrow-up-line"></i>
    </div>
  </div>

  <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
  <!-- Background of PhotoSwipe. 
        It's a separate element as animating opacity is faster than rgba(). -->
  <div class="pswp__bg">
  </div>
  <!-- Slides wrapper with overflow:hidden. -->
  <div class="pswp__scroll-wrap">
    <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
    <div class="pswp__container">
      <div class="pswp__item">
      </div>
      <div class="pswp__item">
      </div>
      <div class="pswp__item">
      </div>
    </div>
    <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
    <div class="pswp__ui pswp__ui--hidden">
      <div class="pswp__top-bar">
        <!--  Controls are self-explanatory. Order can be changed. -->
        <div class="pswp__counter">
        </div>
        <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
        <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
        <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
        <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
        <!-- element will get class pswp__preloader--active when preloader is running -->
        <div class="pswp__preloader">
          <div class="pswp__preloader__icn">
            <div class="pswp__preloader__cut">
              <div class="pswp__preloader__donut">
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
        <div class="pswp__share-tooltip">
        </div>
      </div>
      <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
      </button>
      <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
      </button>
      <div class="pswp__caption">
        <div class="pswp__caption__center">
        </div>
      </div>
    </div>
  </div>
</div>

  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <script src="https://singledigit9.github.io/media/scripts/main.js"></script>
  
  <!-- Code Highlight -->
  
    <script src="https://singledigit9.github.io/media/prism.js"></script>
    <script>
      Prism.highlightAll()
    </script>
  

  <script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>
  <script>
    //拿到预览框架，也就是上面的html代码
    var pswpElement = document.querySelectorAll('.pswp')[0];
    //定义图片数组变量
    var imgitems;
    /**
    * 用于显示预览界面
    * @param index 图片数组下标
    */
    function viewImg(index) {
      //其它选项这里不做过多阐述，详情见官网
      var pswpoptions = {
        index: parseInt(index, 10), // 开始幻灯片索引。0是第一张幻灯片。必须是整数，而不是字符串。
        bgOpacity: 0.7, // 背景透明度，0-1
        maxSpreadZoom: 3, // 缩放级别，不要太大
      };
      //初始化并打开PhotoSwipe，pswpElement对应上面预览框架，PhotoSwipeUI_Default为皮肤，imgitems为图片数组，pswpoptions为选项
      var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, imgitems, pswpoptions);
      gallery.init()
    }
    /**
    * 用于添加图片点击事件
    * @param img 图片元素
    * @param index 所属下标（在imgitems中的位置）
    */
    function addImgClick(img, index) {
      img.onclick = function() {
        viewImg(index)
      }
    }
    /**
    * 轮询所有图片，获取src、width、height等数据，加入imgitems，并给图片元素添加事件
    * 最好在onload中执行该方法，本站因放在最底部，所以直接初始化
    * 异步加载图片可在图片元素创建完成后调用此方法
    */
    function initImg() {
      //重置图片数组
      imgitems = [];
      //查找class:markdown 下的所有img元素并遍历
      var imgs = document.querySelectorAll('.markdown img');
      for (var i = 0; i < imgs.length; i++) {
        var img = imgs[i];
        //本站相册初始为loading图片，真实图片放在data-src
        var ds = img.getAttribute("data-src");
        //创建image对象，用于获取图片宽高
        var imgtemp = new Image();
        //判断是否存在data-src
        if (ds != null && ds.length > 0) {
          imgtemp.src = ds
        } else {
          imgtemp.src = img.src
        }
        //判断是否存在缓存
        if (imgtemp.complete) {
          var imgobj = {
            "src": imgtemp.src,
            "w": imgtemp.width,
            "h": imgtemp.height,
          };
          imgitems[i] = imgobj;
          addImgClick(img, i);
        } else {
          console.log('进来了2')
          imgtemp.index = i;
          imgtemp.img = img;
          imgtemp.onload = function() {
            var imgobj = {
              "src": this.src,
              "w": this.width,
              "h": this.height,
            };
            //不要使用push，因为onload前后顺序会不同
            imgitems[this.index] = imgobj
            //添加点击事件
            addImgClick(this.img, this.index);
          }
        }
      }
    }
    //初始化
    initImg();
  </script>
  
    <script type="application/javascript" src="https://unpkg.com/valine"></script>
<script type="application/javascript">
  new Valine({
    el: '#vlaine-comment',
    appId: 'eXsFKOTvcqH1AMduAwWFwSxB-gzGzoHsz',
    appKey: '01Wiv0MyEtpmkgIz8o9Y9ccM',
    pageSize: 10,
    notify: true,
    avatar: 'mp',
    verify: true,
    placeholder: '来都来了，不妨评论一下',
    visitor: true,
    highlight: true,
    recordIP: true,
  })
</script>
  
  
</body>

</html>